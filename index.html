<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Robot Minisumo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="style.css">
</head>
    <style>

    </style>
<body>
    <div id="video-container">
        <video autoplay muted loop>
            <source src="Fondo video Partículas brillantes  cayendo fondo negro HD.mp4" type="video/mp4">
            Tu navegador no soporta videos HTML5.
        </video>
    </div>
    <div id="joysticks-container">
        <div id="joystick1" class="joystick"></div>
        <div id="joystick2" class="joystick"></div>
            <script>
                document.querySelectorAll('.joystick').forEach(joystick => {
                    function updateShadow(e) {
                        let offsetX, offsetY;

                        // Detectar si es evento de ratón o toque
                        if (e.type === 'mousemove') {
                            const rect = joystick.getBoundingClientRect();
                            offsetX = e.clientX - rect.left - rect.width / 2;
                            offsetY = e.clientY - rect.top - rect.height / 2;
                        } else if (e.type === 'touchmove') {
                            const touch = e.touches[0];
                            const rect = joystick.getBoundingClientRect();
                            offsetX = touch.clientX - rect.left - rect.width / 2;
                            offsetY = touch.clientY - rect.top - rect.height / 2;
                        }

                        // Calcular la dirección y la distancia
                        const distance = Math.sqrt(offsetX * offsetX + offsetY * offsetY);
                        const maxDistance = joystick.offsetWidth / 2;
                        const limitedDistance = Math.min(distance, maxDistance);

                        // Calcular el ángulo de la dirección del movimiento
                        const angle = Math.atan2(offsetY, offsetX);

                        // Calcular el desplazamiento de la sombra basado en el ángulo y la distancia
                        const shadowX = limitedDistance * Math.cos(angle);
                        const shadowY = limitedDistance * Math.sin(angle);

                        // Calcular los componentes RGB para el color de la sombra
                        const r = Math.floor(127 + 127 * Math.cos(angle));
                        const g = Math.floor(127 + 127 * Math.sin(angle));
                        const b = Math.floor(127 - 127 * Math.cos(angle));

                        // Aplicar la sombra dinámica al joystick con el color cambiante
                        joystick.style.boxShadow = `${shadowX}px ${shadowY}px 15px rgba(${r}, ${g}, ${b}, 0.7)`;
                    }

                    function resetShadow() {
                        joystick.style.boxShadow = `0 0 15px rgba(0, 0, 255, 0.5)`;
                    }

                    // Eventos para ratón
                    joystick.addEventListener('mousemove', updateShadow);
                    joystick.addEventListener('mouseleave', resetShadow);

                    // Eventos para dispositivos táctiles
                    joystick.addEventListener('touchmove', updateShadow);
                    joystick.addEventListener('touchend', resetShadow);
                });

            </script>

    </div>
    <div id="buttons-container">
        <button id="adelante">Adelante</button>
        <button id="atras">Atrás</button>
        <button id="izquierda">Izquierda</button>
        <button id="derecha">Derecha</button>
        <button id="detener">Detener</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.10.2/nipplejs.js"></script>
    <script>
        var joystick1 = nipplejs.create({
            zone: document.getElementById('joystick1'),
            mode: 'static',
            position: { left: '50%', top: '50%' },
            color: 'red'
        });

        var joystick2 = nipplejs.create({
            zone: document.getElementById('joystick2'),
            mode: 'static',
            position: { left: '50%', top: '50%' },
            color: 'blue'
        });

        joystick1.on('move', function (evt, data) {
            //handleJoystickMove(data, 'joystick1');
    
                enviarComando("avanzar");
       
       
        
         
            console.log(data)
        });


        joystick1.on('end', function (evt, data) {
            //handleJoystickMove(data, 'joystick1');
    
                enviarComando("stop");
       
       
        
         
            console.log(data)
        });


        joystick2.on('move', function (evt, data) {
            handleJoystickMove(data, 'joystick2');
        });

        document.getElementById('adelante').addEventListener('click', () => enviarComando('avanzar'));
        document.getElementById('atras').addEventListener('click', () => enviarComando('atras'));
        document.getElementById('izquierda').addEventListener('click', () => enviarComando('izquierda'));
        document.getElementById('derecha').addEventListener('click', () => enviarComando('derecha'));
        document.getElementById('detener').addEventListener('click', () => enviarComando('stop'));

        function handleJoystickMove(data, joystickId) {
            if (data && data.direction) {
                let direction = data.direction.angle;
                let force = data.force;
                console.log(`Joystick: ${joystickId}, Dirección: ${direction}, Fuerza: ${force}`);
                enviarComando(`${joystickId}-${direction}-${force}`);
            }
        }

        function enviarComando(accion) {
            const url = `http://192.168.4.1/${accion}`;
            fetch(url)
                .then(response => {
                    if (response.ok) {
                        console.log('Comando enviado exitosamente');
                    } else {
                        console.error('Error al enviar el comando');
                    }
                })
                .catch(error => {
                    console.error('Error de conexión:', error);
                });
        }
    </script>
</body>
</html>
